<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
  />
  <title>Missing Letter Cannon Game</title>
  <style>
    :root {
      --bg: #cfefff;
      --panel: rgba(255,255,255,0.92);
      --ink: #16324a;
      --accent: #2b7cff;
      --good: #21b66f;
      --bad: #ff4d4d;
      --shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    /* Layout */
    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #topBar {
      position: absolute;
      left: 50%;
      top: 12px;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 16px;
      background: var(--panel);
      box-shadow: var(--shadow);
      z-index: 10;
      max-width: min(92vw, 700px);
      width: fit-content;
    }

    #badge {
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      background: #eaf3ff;
      border: 1px solid rgba(43,124,255,0.25);
      color: #1f5fe0;
      font-size: 14px;
      white-space: nowrap;
    }

    #score {
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      background: #eafff4;
      border: 1px solid rgba(33,182,111,0.25);
      color: #158a53;
      font-size: 14px;
      white-space: nowrap;
    }

    #hint {
      font-size: 14px;
      opacity: 0.9;
    }

    #wordArea {
      position: absolute;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      width: min(92vw, 800px);
      height: 44vh;
      display: grid;
      place-items: center;
      z-index: 5;
    }

    /* Floating word card */
    #wordCard {
      position: relative;
      padding: 22px 18px;
      border-radius: 22px;
      background: var(--panel);
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.06);
      max-width: 92vw;
      text-align: center;

      /* subtle float */
      animation: floaty 2.2s ease-in-out infinite;
    }

    @keyframes floaty {
      0%   { transform: translate(0px, 0px) rotate(-0.6deg); }
      50%  { transform: translate(8px, -6px) rotate(0.6deg); }
      100% { transform: translate(0px, 0px) rotate(-0.6deg); }
    }

    #word {
      font-size: clamp(38px, 7vw, 72px);
      font-weight: 900;
      letter-spacing: 0.06em;
      line-height: 1.05;
      user-select: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.06em;
      padding: 4px 10px;
    }

    .letter {
      display: inline-block;
      position: relative;
      min-width: 0.9em;
      text-transform: uppercase;
    }

    .blank {
      display: inline-block;
      min-width: 0.9em;
      border-bottom: 6px solid rgba(22,50,74,0.35);
      padding-bottom: 2px;
      transform: translateY(-2px);
    }

    .blank.filled {
      border-bottom-color: transparent;
    }

    /* Feedback overlays */
    #feedback {
      position: absolute;
      left: 50%;
      top: 55%;
      transform: translate(-50%, -50%);
      z-index: 30;
      pointer-events: none;
      display: none;
      text-align: center;
    }

    #feedback .emoji {
      font-size: 84px;
      filter: drop-shadow(0 12px 10px rgba(0,0,0,0.15));
    }

    #feedback .text {
      margin-top: 6px;
      font-weight: 900;
      font-size: 22px;
    }

    .shake {
      animation: shake 0.45s ease-in-out 1;
    }
    @keyframes shake {
      0% { transform: translate(0,0) rotate(0deg); }
      20% { transform: translate(-6px, 0) rotate(-1deg); }
      40% { transform: translate(6px, 0) rotate(1deg); }
      60% { transform: translate(-5px, 0) rotate(-1deg); }
      80% { transform: translate(5px, 0) rotate(1deg); }
      100% { transform: translate(0,0) rotate(0deg); }
    }

    /* Bottom panel */
    #bottomPanel {
      position: absolute;
      left: 50%;
      bottom: 14px;
      transform: translateX(-50%);
      width: min(96vw, 900px);
      background: var(--panel);
      border-radius: 22px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(0,0,0,0.06);
      padding: 12px;
      z-index: 10;
    }

    #choicesRow {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      padding: 6px 4px 10px;
    }

    .choiceBtn {
      font-size: 22px;
      font-weight: 900;
      width: 62px;
      height: 62px;
      border-radius: 18px;
      border: 2px solid rgba(22,50,74,0.18);
      background: #ffffff;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
      cursor: pointer;
      user-select: none;
      transition: transform 0.12s ease, border-color 0.12s ease, background 0.12s ease;
    }
    .choiceBtn:active { transform: scale(0.96); }
    .choiceBtn.selected {
      border-color: rgba(43,124,255,0.85);
      background: #eaf3ff;
      transform: translateY(-2px);
    }

    #controlsRow {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: end;
      padding: 4px;
    }

    /* Cannon area */
    #cannonWrap {
      position: relative;
      height: 130px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    #cannon {
      position: relative;
      width: 220px;
      height: 110px;
    }

    /* base */
    #cannonBase {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 170px;
      height: 54px;
      border-radius: 18px;
      background: #2b3f54;
      box-shadow: inset 0 8px 0 rgba(255,255,255,0.12), 0 12px 18px rgba(0,0,0,0.12);
    }

    /* barrel */
    #cannonBarrel {
      position: absolute;
      bottom: 38px;
      left: 46%;
      width: 160px;
      height: 38px;
      transform: translateX(-50%) rotate(-10deg);
      transform-origin: left center;
      border-radius: 18px;
      background: #3e5872;
      box-shadow: inset 0 8px 0 rgba(255,255,255,0.12);
    }

    #cannonMouth {
      position: absolute;
      right: -6px;
      top: 6px;
      width: 28px;
      height: 26px;
      border-radius: 14px;
      background: #243647;
      box-shadow: inset 0 6px 0 rgba(255,255,255,0.10);
    }

    #loadedLetter {
      position: absolute;
      left: 50%;
      bottom: 8px;
      transform: translateX(-50%);
      width: 82px;
      height: 48px;
      border-radius: 16px;
      display: grid;
      place-items: center;
      font-weight: 900;
      font-size: 24px;
      color: #0b2a4a;
      background: #ffffff;
      border: 2px dashed rgba(22,50,74,0.25);
      user-select: none;
    }

    /* Fire button */
    #fireBtn {
      font-size: 22px;
      font-weight: 900;
      padding: 16px 22px;
      border-radius: 18px;
      border: none;
      cursor: pointer;
      background: linear-gradient(180deg, #2b7cff, #1f5fe0);
      color: white;
      box-shadow: 0 14px 22px rgba(43,124,255,0.24);
      user-select: none;
    }
    #fireBtn:active { transform: scale(0.98); }
    #fireBtn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* New word / skip */
    #skipBtn {
      justify-self: start;
      font-weight: 800;
      border: 2px solid rgba(22,50,74,0.18);
      background: white;
      color: var(--ink);
      border-radius: 16px;
      padding: 14px 16px;
      cursor: pointer;
      user-select: none;
    }
    #skipBtn:active { transform: scale(0.98); }

    /* Small prompt */
    #toast {
      position: absolute;
      left: 50%;
      bottom: 170px;
      transform: translateX(-50%);
      background: rgba(22,50,74,0.92);
      color: white;
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 800;
      z-index: 50;
      display: none;
      box-shadow: var(--shadow);
    }

    /* Projectile letter */
    .projectile {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 18px;
      display: grid;
      place-items: center;
      font-size: 28px;
      font-weight: 900;
      background: #ffffff;
      border: 3px solid rgba(43,124,255,0.40);
      box-shadow: 0 12px 24px rgba(0,0,0,0.16);
      z-index: 40;
      pointer-events: none;
      user-select: none;
      will-change: transform;
    }

    /* Fireworks canvas */
    #fxCanvas {
      position: absolute;
      inset: 0;
      z-index: 25;
      pointer-events: none;
    }

    /* Responsive tweaks */
    @media (max-height: 650px) {
      #wordArea { top: 78px; height: 40vh; }
      #cannonWrap { height: 115px; }
      #bottomPanel { bottom: 10px; }
    }
  </style>
</head>
<body>
  <div id="game">
    <canvas id="fxCanvas"></canvas>

    <div id="topBar">
      <div id="badge">Missing Letter</div>
      <div id="score">Score: <span id="scoreNum">0</span> ‚≠ê</div>
      <div id="hint">Pick the missing letter and tap <b>FIRE</b>.</div>
    </div>

    <div id="wordArea">
      <div id="wordCard">
        <div id="word" aria-label="Word with missing letter"></div>
      </div>
    </div>

    <div id="feedback">
      <div class="emoji" id="feedbackEmoji">üò¢</div>
      <div class="text" id="feedbackText">Try again!</div>
    </div>

    <div id="toast"></div>

    <div id="bottomPanel">
      <div id="choicesRow" aria-label="Letter choices"></div>

      <div id="controlsRow">
        <button id="skipBtn" type="button">New Word</button>

        <div id="cannonWrap">
          <div id="cannon">
            <div id="cannonBarrel">
              <div id="cannonMouth"></div>
            </div>
            <div id="cannonBase"></div>
            <div id="loadedLetter">?</div>
          </div>
        </div>

        <button id="fireBtn" type="button">FIRE üöÄ</button>
      </div>
    </div>
  </div>

  <script>
    // --- Word list (animals / fruits / birds) ---
    const WORDS = [
      // Animals
      { word: "tiger", type: "animal" },
      { word: "zebra", type: "animal" },
      { word: "monkey", type: "animal" },
      { word: "elephant", type: "animal" },
      { word: "giraffe", type: "animal" },
      { word: "rabbit", type: "animal" },
      { word: "lion", type: "animal" },
      { word: "panda", type: "animal" },
      { word: "donkey", type: "animal" },

      // Fruits
      { word: "banana", type: "fruit" },
      { word: "apple", type: "fruit" },
      { word: "mango", type: "fruit" },
      { word: "orange", type: "fruit" },
      { word: "grapes", type: "fruit" },
      { word: "papaya", type: "fruit" },
      { word: "cherry", type: "fruit" },
      { word: "melon", type: "fruit" },

      // Birds
      { word: "parrot", type: "bird" },
      { word: "sparrow", type: "bird" },
      { word: "peacock", type: "bird" },
      { word: "pigeon", type: "bird" },
      { word: "eagle", type: "bird" },
      { word: "owl", type: "bird" },
      { word: "crow", type: "bird" }
    ];

    // --- Elements ---
    const gameEl = document.getElementById("game");
    const wordEl = document.getElementById("word");
    const choicesRow = document.getElementById("choicesRow");
    const loadedLetterEl = document.getElementById("loadedLetter");
    const fireBtn = document.getElementById("fireBtn");
    const skipBtn = document.getElementById("skipBtn");
    const toastEl = document.getElementById("toast");
    const scoreNumEl = document.getElementById("scoreNum");

    const feedbackEl = document.getElementById("feedback");
    const feedbackEmojiEl = document.getElementById("feedbackEmoji");
    const feedbackTextEl = document.getElementById("feedbackText");

    const canvas = document.getElementById("fxCanvas");
    const ctx = canvas.getContext("2d");

    // --- Game state ---
    let current = null;          // {word, type, missingIndex, missingChar}
    let selectedLetter = null;   // "a"
    let animating = false;
    let score = 0;

    // --- Helpers ---
    function randInt(min, maxInclusive) {
      return Math.floor(Math.random() * (maxInclusive - min + 1)) + min;
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function showToast(msg, ms = 1200) {
      toastEl.textContent = msg;
      toastEl.style.display = "block";
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => {
        toastEl.style.display = "none";
      }, ms);
    }

    function setCanvasSize() {
      const dpr = window.devicePixelRatio || 1;
      canvas.width = Math.floor(window.innerWidth * dpr);
      canvas.height = Math.floor(window.innerHeight * dpr);
      canvas.style.width = window.innerWidth + "px";
      canvas.style.height = window.innerHeight + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    window.addEventListener("resize", setCanvasSize);
    setCanvasSize();

    // --- Render word with missing letter ---
    function renderWord() {
      wordEl.innerHTML = "";
      const w = current.word.toUpperCase();

      for (let i = 0; i < w.length; i++) {
        const span = document.createElement("span");
        span.className = "letter";

        if (i === current.missingIndex) {
          span.classList.add("blank");
          span.dataset.blank = "1";
          span.textContent = " ";
        } else {
          span.textContent = w[i];
        }
        wordEl.appendChild(span);
      }
    }

    function getBlankElement() {
      return wordEl.querySelector('[data-blank="1"]');
    }

    function generateChoices(correctChar) {
      const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      const options = new Set([correctChar]);

      // Make 3-5 options total depending on word length
      const total = (current.word.length <= 5) ? 3 : 4;
      while (options.size < total) {
        options.add(alphabet[randInt(0, alphabet.length - 1)]);
      }
      return shuffle([...options]);
    }

    function clearSelectionUI() {
      selectedLetter = null;
      loadedLetterEl.textContent = "?";
      document.querySelectorAll(".choiceBtn").forEach(b => b.classList.remove("selected"));
    }

    // --- New round ---
    function newRound() {
      animating = false;
      fireBtn.disabled = false;
      hideFeedback();

      clearSelectionUI();

      const pick = WORDS[randInt(0, WORDS.length - 1)];
      const word = pick.word.trim().toLowerCase();

      // choose missing index (avoid 0 sometimes for easier reading)
      const minIndex = word.length >= 4 ? 1 : 0;
      const maxIndex = word.length - 2 >= minIndex ? word.length - 2 : word.length - 1;
      const missingIndex = randInt(minIndex, maxIndex);

      current = {
        word,
        type: pick.type,
        missingIndex,
        missingChar: word[missingIndex].toUpperCase()
      };

      renderWord();

      // Build choices
      const choices = generateChoices(current.missingChar);
      choicesRow.innerHTML = "";

      choices.forEach(ch => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choiceBtn";
        btn.textContent = ch;
        btn.addEventListener("click", () => {
          if (animating) return;
          selectedLetter = ch;
          loadedLetterEl.textContent = ch;
          document.querySelectorAll(".choiceBtn").forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");
        });
        choicesRow.appendChild(btn);
      });
    }

    // --- Projectile animation ---
    function getCannonMouthCenter() {
      const mouth = document.getElementById("cannonMouth");
      const r = mouth.getBoundingClientRect();
      return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
    }

    function getBlankCenter() {
      const blank = getBlankElement();
      const r = blank.getBoundingClientRect();
      return { x: r.left + r.width / 2, y: r.top + r.height / 2 };
    }

    function animateShot(letter, onDone) {
      const start = getCannonMouthCenter();
      const end = getBlankCenter();

      const proj = document.createElement("div");
      proj.className = "projectile";
      proj.textContent = letter;

      // place at start (centered)
      proj.style.left = (start.x - 30) + "px";
      proj.style.top  = (start.y - 30) + "px";

      // initial transform
      proj.style.transform = "translate(0px, 0px) scale(1)";

      document.body.appendChild(proj);

      // Use transform to animate
      const dx = (end.x - start.x);
      const dy = (end.y - start.y);

      // ensure transition triggers
      requestAnimationFrame(() => {
        proj.style.transition = "transform 520ms cubic-bezier(0.2, 0.9, 0.2, 1.0)";
        proj.style.transform = `translate(${dx}px, ${dy}px) scale(0.92)`;
      });

      proj.addEventListener("transitionend", () => {
        proj.remove();
        onDone?.();
      }, { once: true });
    }

    // --- Feedback ---
    function showFeedback(ok) {
      feedbackEl.style.display = "block";
      if (ok) {
        feedbackEmojiEl.textContent = "üéâ";
        feedbackTextEl.textContent = "Correct!";
      } else {
        feedbackEmojiEl.textContent = "üò¢";
        feedbackTextEl.textContent = "Try again!";
      }
    }

    function hideFeedback() {
      feedbackEl.style.display = "none";
    }

    // --- Fireworks effect (simple particles) ---
    let particles = [];
    let fxRunning = false;

    function launchFireworks(x, y) {
      // x,y are in CSS pixels
      const count = 90;
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = 2 + Math.random() * 4.5;
        particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          life: 50 + Math.random() * 30,
          size: 2 + Math.random() * 2.5,
          // random bright color
          r: randInt(80, 255),
          g: randInt(80, 255),
          b: randInt(80, 255),
        });
      }
      if (!fxRunning) {
        fxRunning = true;
        requestAnimationFrame(fxLoop);
      }
    }

    function fxLoop() {
      // clear with slight fade
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // draw particles
      ctx.save();
      for (const p of particles) {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.06; // gravity
        p.vx *= 0.99;
        p.vy *= 0.99;
        p.life -= 1;

        const alpha = Math.max(0, p.life / 80);
        ctx.globalAlpha = alpha;
        ctx.fillStyle = `rgb(${p.r},${p.g},${p.b})`;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.restore();

      particles = particles.filter(p => p.life > 0);

      if (particles.length > 0) {
        requestAnimationFrame(fxLoop);
      } else {
        fxRunning = false;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    }

    // --- Main action ---
    function fire() {
      if (animating) return;

      if (!selectedLetter) {
        showToast("Select a letter first üôÇ");
        return;
      }

      animating = true;
      fireBtn.disabled = true;
      hideFeedback();

      animateShot(selectedLetter, () => {
        const ok = (selectedLetter === current.missingChar);

        if (ok) {
          // Fill the blank
          const blank = getBlankElement();
          blank.classList.add("filled");
          blank.textContent = current.missingChar;
          blank.style.color = "#0b2a4a";

          showFeedback(true);

          // fireworks at blank
          const c = getBlankCenter();
          launchFireworks(c.x, c.y);

          score += 1;
          scoreNumEl.textContent = String(score);

          // Next round after a short delay
          setTimeout(() => {
            newRound();
          }, 1100);
        } else {
          // Wrong: show sad face and allow try again
          showFeedback(false);
          document.getElementById("wordCard").classList.remove("shake");
          void document.getElementById("wordCard").offsetWidth; // restart animation trick
          document.getElementById("wordCard").classList.add("shake");

          // keep state; allow another try
          setTimeout(() => {
            fireBtn.disabled = false;
            animating = false;
          }, 350);
        }
      });
    }

    // --- Buttons ---
    fireBtn.addEventListener("click", fire);
    skipBtn.addEventListener("click", () => {
      if (animating) return;
      newRound();
    });

    // Start
    newRound();
  </script>
</body>
</html>
