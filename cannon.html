<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Missing Letter Word Game (Offline)</title>

  <style>
    :root{
      --bg:#cfefff;
      --panel:rgba(255,255,255,0.92);
      --ink:#16324a;
      --accent:#2b7cff;
      --good:#1ea85e;
      --bad:#ff4d4d;
      --shadow:0 10px 25px rgba(0,0,0,0.12);
      --vh:1vh;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--ink);
      overflow:hidden;
      touch-action:manipulation;
      -webkit-tap-highlight-color:transparent;
    }

    #game{
      position:relative;
      width:100vw;
      height:calc(var(--vh) * 100);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    #topBar{
      margin:calc(10px + env(safe-area-inset-top)) auto 10px;
      width:min(94vw,900px);
      background:var(--panel);
      box-shadow:var(--shadow);
      border-radius:16px;
      padding:10px 12px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
      border:1px solid rgba(0,0,0,0.06);
      z-index:5;
    }
    #badge{
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      background:#eaf3ff;
      border:1px solid rgba(43,124,255,0.25);
      color:#1f5fe0;
      font-size:14px;
      white-space:nowrap;
    }
    #score{
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      background:#eafff4;
      border:1px solid rgba(33,182,111,0.25);
      color:#158a53;
      font-size:14px;
      white-space:nowrap;
    }
    #hint{font-size:14px;opacity:0.9;text-align:center}

    #speakToggle{
      font-weight:950;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(22,50,74,0.18);
      background:#fff;
      cursor:pointer;
      user-select:none;
      font-size:14px;
      white-space:nowrap;
      box-shadow:0 6px 14px rgba(0,0,0,0.06);
    }
    #speakToggle:active{transform:scale(0.98)}

    #wordArea{
      flex:1;
      display:grid;
      place-items:center;
      padding:8px 10px;
      min-height:0;
      z-index:4;
    }
    #wordCard{
      width:min(94vw,900px);
      background:var(--panel);
      box-shadow:var(--shadow);
      border-radius:22px;
      border:1px solid rgba(0,0,0,0.06);
      padding:16px 14px;
      text-align:center;
      animation:floaty 2.2s ease-in-out infinite;
      position:relative;
      overflow:hidden;
    }
    @keyframes floaty{
      0%{transform:translate(0,0)}
      50%{transform:translate(6px,-5px)}
      100%{transform:translate(0,0)}
    }

    #word{
      font-size:clamp(34px,8.2vw,74px);
      font-weight:950;
      letter-spacing:0.06em;
      line-height:1.05;
      user-select:none;
      display:inline-flex;
      gap:0.06em;
      padding:6px 8px 2px;
      text-transform:uppercase;
      justify-content:center;
      flex-wrap:wrap;
    }

    .letter{display:inline-block;min-width:0.9em;position:relative}
    .blank{
      min-width:0.9em;
      border-bottom:6px solid rgba(22,50,74,0.35);
      padding-bottom:2px;
      transform:translateY(-2px);
    }
    .blank.filled{border-bottom-color:transparent}

    #resultCard{
      margin-top:10px;
      display:none;
      text-align:left;
      background:rgba(255,255,255,0.92);
      border:1px solid rgba(0,0,0,0.06);
      border-radius:18px;
      padding:12px 12px;
      box-shadow:0 10px 20px rgba(0,0,0,0.10);
    }
    #resultTitle{
      font-weight:950;
      font-size:18px;
      margin:0 0 6px;
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    #meaning, #sentence, #spelling{
      margin:6px 0 0;
      font-size:15px;
      line-height:1.35;
    }
    .label{font-weight:900;opacity:0.9}

    #resultButtons{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .smallBtn{
      font-size:14px;
      font-weight:950;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(22,50,74,0.18);
      background:#fff;
      cursor:pointer;
      user-select:none;
      box-shadow:0 8px 14px rgba(0,0,0,0.06);
    }
    .smallBtn:active{transform:scale(0.98)}

    #bottomPanel{
      width:min(96vw,920px);
      margin:0 auto;
      background:var(--panel);
      border-radius:22px;
      box-shadow:var(--shadow);
      border:1px solid rgba(0,0,0,0.06);
      padding:10px 10px calc(10px + env(safe-area-inset-bottom));
      margin-bottom:env(safe-area-inset-bottom);
      z-index:6;
    }
    #choicesRow{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      padding:6px 4px 10px;
    }
    .choiceBtn{
      font-size:clamp(18px,5.2vw,22px);
      font-weight:950;
      width:clamp(54px,15vw,66px);
      height:clamp(54px,15vw,66px);
      border-radius:16px;
      border:2px solid rgba(22,50,74,0.18);
      background:#fff;
      box-shadow:0 6px 14px rgba(0,0,0,0.08);
      cursor:pointer;
      user-select:none;
      transition:transform 0.12s ease, border-color 0.12s ease, background 0.12s ease;
    }
    .choiceBtn:active{transform:scale(0.96)}
    .choiceBtn:disabled{opacity:0.55;cursor:not-allowed;box-shadow:none}

    #controlsRow{
      display:flex;
      justify-content:center;
      gap:10px;
      align-items:center;
      padding:4px 0 0;
    }
    #nextBtn{
      display:none;
      font-size:18px;
      font-weight:950;
      padding:14px 16px;
      border-radius:16px;
      border:none;
      cursor:pointer;
      background:linear-gradient(180deg,#2b7cff,#1f5fe0);
      color:#fff;
      box-shadow:0 14px 22px rgba(43,124,255,0.24);
      user-select:none;
      white-space:nowrap;
    }
    #nextBtn:active{transform:scale(0.98)}

    #toast{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:calc(160px + env(safe-area-inset-bottom));
      background:rgba(22,50,74,0.92);
      color:#fff;
      padding:10px 14px;
      border-radius:14px;
      font-weight:950;
      z-index:9;
      display:none;
      box-shadow:var(--shadow);
      max-width:92vw;
      text-align:center;
    }

    .flyLetter{
      position:absolute;
      width:56px;height:56px;border-radius:16px;
      display:grid;place-items:center;
      font-size:26px;font-weight:950;
      background:#fff;
      border:3px solid rgba(43,124,255,0.40);
      box-shadow:0 12px 24px rgba(0,0,0,0.16);
      z-index:20;
      pointer-events:none;
      user-select:none;
      will-change:transform;
    }

    .shake{animation:shake 0.45s ease-in-out 1}
    @keyframes shake{
      0%{transform:translate(0,0)}
      20%{transform:translate(-6px,0)}
      40%{transform:translate(6px,0)}
      60%{transform:translate(-5px,0)}
      80%{transform:translate(5px,0)}
      100%{transform:translate(0,0)}
    }

    #errorOverlay{
      position:absolute;inset:0;z-index:999;
      display:none;place-items:center;
      padding:18px;
      background:rgba(0,0,0,0.78);
      color:#fff;
      font-weight:950;
      text-align:left;
      overflow:auto;
    }
    #errorOverlay pre{
      white-space:pre-wrap;
      background:rgba(255,0,0,0.18);
      border:1px solid rgba(255,255,255,0.2);
      border-radius:14px;
      padding:14px;
      max-width:min(900px,96vw);
    }

    @media (max-width:380px){
      #toast{bottom:calc(210px + env(safe-area-inset-bottom))}
      .choiceBtn{width:54px;height:54px}
    }
  </style>
</head>

<body>
  <div id="game">
    <div id="topBar">
      <div id="badge">Offline ‚Ä¢ Missing Letter</div>
      <div id="score">Score: <span id="scoreNum">0</span> ‚≠ê</div>
      <div id="hint">Tap the missing letter.</div>
      <button id="speakToggle" type="button">üîä Speak: ON</button>
    </div>

    <div id="wordArea">
      <div id="wordCard">
        <div id="word"></div>

        <div id="resultCard">
          <div id="resultTitle"></div>
          <div id="meaning"></div>
          <div id="sentence"></div>
          <div id="spelling"></div>

          <div id="resultButtons">
            <button id="speakAgainBtn" class="smallBtn" type="button">üîä Speak again</button>
            <button id="stopSpeakBtn" class="smallBtn" type="button">‚èπ Stop</button>
          </div>
        </div>
      </div>
    </div>

    <div id="toast"></div>

    <div id="bottomPanel">
      <div id="choicesRow"></div>
      <div id="controlsRow">
        <button id="nextBtn" type="button">Next Word ‚ûú</button>
      </div>
    </div>

    <div id="errorOverlay"><pre id="errorText"></pre></div>
  </div>

  <script>
    function showError(err) {
      const overlay = document.getElementById("errorOverlay");
      const text = document.getElementById("errorText");
      overlay.style.display = "grid";
      text.textContent =
        "JavaScript error (this is why the page looked blank):\n\n" +
        (err && err.stack ? err.stack : String(err));
    }
    window.addEventListener("error", (e) => showError(e.error || e.message));
    window.addEventListener("unhandledrejection", (e) => showError(e.reason));

    document.addEventListener("DOMContentLoaded", () => {
      try {
        // iPhone Safari viewport height fix
        function setVH() {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty("--vh", `${vh}px`);
        }
        window.addEventListener("resize", setVH);
        window.addEventListener("orientationchange", setVH);
        setVH();

        // Elements
        const wordEl = document.getElementById("word");
        const choicesRow = document.getElementById("choicesRow");
        const toastEl = document.getElementById("toast");
        const scoreNumEl = document.getElementById("scoreNum");
        const wordCardEl = document.getElementById("wordCard");

        const resultCard = document.getElementById("resultCard");
        const resultTitle = document.getElementById("resultTitle");
        const meaningEl = document.getElementById("meaning");
        const sentenceEl = document.getElementById("sentence");
        const spellingEl = document.getElementById("spelling");
        const nextBtn = document.getElementById("nextBtn");

        const speakToggle = document.getElementById("speakToggle");
        const speakAgainBtn = document.getElementById("speakAgainBtn");
        const stopSpeakBtn = document.getElementById("stopSpeakBtn");

        // Helpers
        function randInt(min, maxInclusive) {
          return Math.floor(Math.random() * (maxInclusive - min + 1)) + min;
        }
        function shuffle(arr) {
          for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        }
        function showToast(msg, ms = 1200) {
          toastEl.textContent = msg;
          toastEl.style.display = "block";
          clearTimeout(showToast._t);
          showToast._t = setTimeout(() => (toastEl.style.display = "none"), ms);
        }
        function capWord(w){ return w ? (w[0].toUpperCase() + w.slice(1)) : w; }
        function spellOut(word) { return word.toUpperCase().split("").join(" - "); }

        function articleFor(word) {
          const w = word.toLowerCase();
          const vowels = ["a","e","i","o","u"];
          return vowels.includes(w[0]) ? "an" : "a";
        }

        // ----------------------------
        // SPEECH
        // ----------------------------
        let speakOn = true;
        let lastSpeechText = "";

        function stopSpeaking() {
          if ("speechSynthesis" in window) window.speechSynthesis.cancel();
        }
        function speak(text) {
          if (!speakOn) return;
          if (!("speechSynthesis" in window)) return;

          stopSpeaking();
          lastSpeechText = text;

          const u = new SpeechSynthesisUtterance(text);
          u.lang = "en-US";
          u.rate = 0.92;
          u.pitch = 1.0;

          const voices = window.speechSynthesis.getVoices?.() || [];
          const v = voices.find(v => /en/i.test(v.lang)) || null;
          if (v) u.voice = v;

          window.speechSynthesis.speak(u);
        }

        if ("speechSynthesis" in window) {
          window.speechSynthesis.onvoiceschanged = () => {};
        }

        speakToggle.addEventListener("click", () => {
          speakOn = !speakOn;
          speakToggle.textContent = speakOn ? "üîä Speak: ON" : "üîá Speak: OFF";
          if (!speakOn) stopSpeaking();
        });
        speakAgainBtn.addEventListener("click", () => {
          if (lastSpeechText) speak(lastSpeechText);
        });
        stopSpeakBtn.addEventListener("click", stopSpeaking);

        // ----------------------------
        // OFFLINE WORDS (20 per alphabet = 520)
        // ----------------------------
        const WORD_BANK = {
          "A": ["apple","ant","alligator","airplane","astronaut","anchor","acorn","aquarium","apron","ambulance","artist","arrow","atlas","aurora","asteroid","autumn","alphabet","avalanche","attic","axolotl"],
          "B": ["banana","bear","bee","beaver","butterfly","balloon","bicycle","book","bridge","bucket","bubble","button","backpack","bakery","baseball","beach","beehive","binoculars","blanket","broccoli"],
          "C": ["cat","carrot","castle","candle","camera","cactus","calendar","camel","canoe","carnival","cereal","cloud","compass","cupcake","coral","crayon","crocodile","crystal","computer","coin"],
          "D": ["dog","duck","dolphin","dinosaur","dragon","donut","drum","doctor","diamond","desert","dance","drawing","dictionary","detective","doorway","dandelion","driftwood","downpour","daydream","dungeon"],
          "E": ["elephant","eagle","earth","eclipse","engine","envelope","emerald","energy","elevator","emperor","earphones","easel","echo","evergreen","edge","evidence","explorer","exercise","eyeglasses","electricity"],
          "F": ["frog","fox","fish","flower","forest","fireworks","flashlight","feather","fountain","festival","football","friendship","fable","farmer","ferry","fence","fingerprint","freezer","fruit","flute"],
          "G": ["goat","goose","giraffe","garden","galaxy","glacier","guitar","goldfish","gem","grocery","greenhouse","goggles","gravity","gingerbread","geyser","grapefruit","glowworm","goalkeeper","globe","gondola"],
          "H": ["horse","hamster","helicopter","hospital","honey","honeycomb","hurricane","hill","horizon","homework","hammer","heartbeat","hedgehog","hibernation","highway","hoodie","hydrant","hydrogen","hologram","hummingbird"],
          "I": ["iguana","icicle","iceberg","island","invention","internet","insect","ink","instrument","invitation","idea","identity","imagination","icecream","iron","igloo","illustration","iris","inchworm","industry"],
          "J": ["jaguar","jellyfish","jacket","jigsaw","journey","jungle","joystick","journal","jewel","juice","jar","jellybean","jet","jupiter","jogger","juggler","jubilee","justice","joey","jamboree"],
          "K": ["kangaroo","koala","kitten","keyboard","kite","kingdom","kettle","ketchup","kiwi","kaleidoscope","karate","kayak","key","knee","knight","knowledge","kitchen","kilometer","kiosk","kickball"],
          "L": ["lion","lemon","ladder","lake","landscape","lighthouse","lightning","library","lollipop","laptop","leaf","lizard","laughter","lavender","locomotive","lunchbox","lantern","lifeguard","lullaby","lunar"],
          "M": ["monkey","mountain","meteor","microscope","magnet","marshmallow","melody","mermaid","mushroom","museum","motorbike","mailbox","map","marble","meadow","milkshake","minute","mirror","moonlight","multiverse"],
          "N": ["narwhal","notebook","newspaper","necklace","neighborhood","nightfall","northstar","nugget","number","navigator","nest","noodle","novel","nurse","nature","nectar","network","ninja","nutmeg","nylon"],
          "O": ["octopus","orange","oatmeal","ocean","orchestra","origami","obstacle","observatory","oxygen","odyssey","onion","otter","oven","owl","orchard","orbit","opal","opera","oar","outfit"],
          "P": ["penguin","pineapple","pumpkin","playground","parachute","puzzle","paintbrush","paperclip","popcorn","princess","planet","planetarium","photograph","pirate","pancake","pepper","pocket","potion","protein","puppy"],
          "Q": ["queen","quail","quilt","quarter","question","quartz","quiver","quiz","quokka","quill","quarry","quartet","quasar","quagmire","quarantine","quotation","quest","quicksand","quiche","quicksilver"],
          "R": ["rabbit","rainbow","rocket","robot","raccoon","reindeer","rhinoceros","river","riddle","refrigerator","recycling","roadtrip","raindrop","rescue","reflection","remote","restaurant","ribbon","rollercoaster","raspberry"],
          "S": ["sun","star","spaceship","snowflake","strawberry","sandcastle","scooter","starfish","sparkle","sunshine","storybook","superhero","symphony","sunscreen","scientist","scavenger","skyline","soundwave","sugarplum","swordfish"],
          "T": ["tiger","telescope","treasure","tornado","tangerine","trampoline","toolbox","toothbrush","thunder","titanium","timetable","turtleneck","teardrop","touchdown","trailblazer","transformer","tapestry","turtle","teapot","trafficlight"],
          "U": ["umbrella","unicorn","universe","unicycle","underwater","upgrade","utensil","uniform","ukulele","ultrasound","updraft","uproar","unison","undertow","utility","university","uprising","uppercase","user","utopia"],
          "V": ["volcano","vacation","victory","velvet","vibration","violin","videogame","village","vocabulary","valentine","vegetable","veteran","viewpoint","vineyard","volleyball","voyager","vulture","van","vase","vehicle"],
          "W": ["whale","waterfall","whirlwind","wonderland","wagon","wilderness","waffles","wetsuit","whisper","wizard","wildflower","workshop","woodpecker","watchtower","wavelength","waterslide","windmill","wristwatch","wallpaper","worldmap"],
          "X": ["xylophone","xray","xenon","xylem","xerox","xylitol","xenolith","xenophile","xenophobe","xenogenesis","xiphoid","xiphosura","xystus","xylan","xylocarp","xerophyte","xanthate","xanthophyll","xenopus","xenocracy"],
          "Y": ["yak","yam","yarn","yacht","yard","yardstick","yearbook","yeast","yoga","yogurt","yolk","yurt","yew","yellowfin","yodel","youngster","yesterday","yulelog","yarrow","yeti"],
          "Z": ["zebra","zucchini","zipper","zoo","zookeeper","zeppelin","zigzag","zodiac","zero","zenith","zircon","zinnia","zest","zombie","zone","zoom","zither","zebu","zirconium","zwitterion"]
        };

        const MEANINGS_BY_LETTER = {
          "A": ["a sweet round fruit","a small insect that lives in groups","a large reptile with sharp teeth","a flying vehicle with wings","a person who travels in space","a heavy object that holds a boat still","a nut from an oak tree","a tank where fish and sea animals live","a cloth you wear to protect clothes while cooking","a vehicle that takes sick people to the hospital","a person who makes art","a pointed weapon or sign that shows direction","a book of maps","natural lights that shine in the night sky","a rocky object that orbits the sun","the season after summer","the set of letters used to write","a fast slide of snow down a mountain","a space just under the roof of a house","a small water animal that can grow back parts"],
          "B": ["a long yellow fruit","a large furry animal","an insect that can make honey","an animal that builds dams","an insect with colorful wings","a rubbery bag filled with air","a two-wheeled vehicle you pedal","a set of pages you read","a structure that crosses over water or roads","a container used to carry things","a round ball of air or soap","a small fastener you push to close clothes","a bag you carry on your back","a place where bread and cakes are made","a sport played with a bat and ball","a sandy place by the ocean or lake","a home made of wax for bees","tools to see faraway things","a soft cover used to keep warm","a green vegetable shaped like small trees"],
          "C": ["a small pet animal that says meow","an orange vegetable that rabbits like","a big strong building with towers","a stick of wax you light for a flame","a device used to take pictures","a plant that grows in dry places and has spines","a chart that shows days and months","a desert animal with humps","a small narrow boat you paddle","a fun event with rides and games","a breakfast food made from grains","white fluffy water drops in the sky","a tool that shows directions like north","a small cake in a paper cup","a hard material made by sea animals","a colored wax stick for drawing","a large reptile that lives in rivers","a clear stone that sparkles","an electronic machine for doing work and games","a round piece of metal used as money"],
          "D": ["a pet animal that barks","a bird that swims and waddles","a smart sea animal that jumps","a giant animal that lived long ago","a make-believe creature like a big lizard","a sweet ring-shaped treat","a musical instrument you hit to make beats","a person who helps sick people get better","a very hard shiny stone","a very dry place with sand","moving your body to music","a picture you make with pencil or paint","a book that explains word meanings","a person who solves mysteries","a way into or out of a room","a yellow flower that turns into fluffy seeds","wood that washes up on a beach","a very heavy rain","a pleasant daydream in your mind","an underground room in an old story"],
          "E": ["a very large animal with a trunk","a large bird that can fly high","the planet we live on","when the sun or moon looks partly covered","a machine that makes things move","a paper cover for a letter","a green precious stone","power used to do work","a moving box that carries people up and down","a ruler of an empire","devices you wear to listen to sound","a stand for holding paper while painting","a sound that repeats back","a tree that stays green all year","the outside line of something","facts or clues that show something is true","a person who travels to learn and discover","physical activity that keeps you healthy","glasses you wear to see better","energy that powers lights and devices"],
          "F": ["a small jumping animal that lives near water","a wild animal with a bushy tail","an animal that swims in water","a plant that makes blossoms","a large area full of trees","bright exploding lights in the sky","a hand-held light for the dark","a light part of a bird","a place where water shoots up","a celebration with food and music","a sport played with an oval ball","being kind and friendly to someone","a short story that teaches a lesson","a person who grows crops or raises animals","a boat that carries people across water","a wall that marks a border","the patterns on your finger tips","a machine that keeps food very cold","food from plants that you can eat","a musical instrument you blow like a small pipe"],
          "G": ["a farm animal that gives milk","a bird that honks and can fly","a very tall animal with a long neck","a place where plants are grown","a huge group of stars in space","a large slow river of ice","a musical instrument with strings","a small pet fish that is orange","a precious stone","a store where you buy food","a building for growing plants with glass walls","eye covers that protect your eyes","the force that pulls things down","a sweet cookie made with ginger","a hot spring that shoots water into the air","a large citrus fruit that is sour-sweet","a tiny animal that glows at night","a player who guards a goal in sports","a round model of Earth","a hanging cabin that rides on a cable"],
          "H": ["a large animal you can ride","a small pet that likes to run in a wheel","a flying vehicle with spinning blades","a place where doctors and nurses help people","a sweet sticky food made by bees","cells of wax where bees store honey","a very strong storm with powerful winds","a raised area of land","the line where the sky meets the land","work you do for school at home","a tool used to hit nails","the sound or beat of your heart","a small animal with spines","a long winter sleep for some animals","a big road with fast cars","a warm sweatshirt with a hood","a device that gives water in an emergency","a very light gas found in water","a picture made of light that looks 3D","a small bird that can hover in the air"],
          "I": ["a lizard-like animal that lives in warm places","a pointed piece of hanging ice","a big piece of ice floating in water","land surrounded by water","a new thing someone makes","a system that connects computers worldwide","a small animal with six legs","colored liquid used for writing","a tool or object used to make music","a request to come to an event","a thought or plan in your mind","who a person is","the ability to make pictures in your mind","a cold sweet dessert","a strong metal used to make tools","a small house made of snow blocks","a picture that explains something","a part of the eye that controls light","a tiny caterpillar that moves in loops","work and businesses in a country"],
          "J": ["a big wild cat with spots","a sea animal with a soft body and tentacles","clothing you wear on your upper body","a puzzle made from many pieces","a trip from one place to another","a thick forest in a hot place","a control stick for games","a book where you write thoughts","a small valuable stone","a drink made from fruit","a container with a wide mouth","a small candy bean","a fast airplane with engines","a very large planet in our solar system","a person who runs for exercise","a person who tosses and catches objects for fun","a happy celebration","fair and correct treatment for people","a baby kangaroo","a lively party or celebration"],
          "K": ["a hopping animal that carries babies in a pouch","a gray bear-like animal that eats leaves","a young cat","a set of buttons you type on","a toy that flies on a string","a land ruled by a king or queen","a pot used to boil water","a sauce often put on fries","a small brown fruit with green inside","a tube toy that shows colorful patterns","a sport of kicking and punching moves","a small boat you paddle","a tool that opens locks","a joint in your leg","a warrior in armor from old times","information you learn and remember","a room where food is cooked","a unit for measuring distance","a small stall or booth","a ball game where you kick and run"],
          "L": ["a big wild cat with a mane","a sour yellow fruit","a tool you climb to reach high places","a large body of water surrounded by land","the view of land and scenery","a tower with a light for ships","a bright flash in a storm","a place where you borrow books","a sweet candy on a stick","a small computer you can carry","a green part of a plant","a small reptile with a long tail","the sound of being happy and laughing","a purple plant with a nice smell","the engine part of a train","a box to carry lunch","a light you can carry that uses a flame or bulb","a person who watches swimmers to keep them safe","a gentle song to help someone sleep","related to the moon"],
          "M": ["a playful animal that lives in trees","a very high land area","a rock from space that can streak in the sky","a tool to see tiny things","a tool that pulls metal","a soft sweet puffy treat","a tune you can hum","a make-believe sea person with a tail","a fungus that can grow in soil","a place to see art and old things","a motorcycle with a motor","a box where you receive letters","a drawing of places and roads","a small smooth stone used in games","a grassy field","a cold sweet drink made from milk","sixty seconds of time","a surface that shows your reflection","light from the moon","a make-believe idea of many universes"],
          "N": ["a sea animal like a whale with a horn","a book for writing notes","papers with news and stories","jewelry you wear around your neck","an area where people live near you","the time when night begins","a bright star used for direction","a small piece of gold or food","a symbol used for counting","a helper that guides a ship or plane","a home made by birds","long soft food made from dough","a long story book","a person who cares for sick people","everything in the natural world","sweet liquid made by flowers","a group of connected computers","a person trained in sneaky skills in stories","a spice that tastes warm and sweet","a strong material used for fabric and rope"],
          "O": ["a sea animal with eight arms","a round orange-colored fruit","a warm breakfast made from oats","the huge salty water on Earth","a big group of musicians","paper folding to make shapes","something that blocks your way","a place to watch stars and space","a gas we need to breathe","a long adventurous journey","a round vegetable that can make you cry","a playful water animal","a kitchen machine for baking","a bird that hunts at night","a place where fruit trees grow","the path of a planet around a star","a shiny colorful stone","a show with singing and music","a paddle used to move a boat","the clothes you wear"],
          "P": ["a black and white bird that cannot fly","a spiky tropical fruit that is sweet","a round orange squash","a place with slides and swings","a cloth that helps you float down safely","a game with pieces you fit together","a brush used to paint","a small clip for holding papers","a snack made from popped corn","a royal girl in stories","a big round object in space","a building that shows the night sky","a picture made with a camera","a sailor who steals in stories","a flat cake cooked on a pan","a spicy vegetable used for flavor","a small bag in clothing","a drink or mixture in stories and science","a nutrient that helps you grow strong","a young dog"],
          "Q": ["a female ruler in a kingdom","a small bird like a chicken","a warm blanket made from pieces of cloth","one fourth of something","something you ask to learn","a hard crystal rock","a case for arrows","a game of questions for points","a small animal from Australia","a feather from a bird","a place where stone is dug out","four musicians playing together","a very bright object in space","a muddy swampy place","a time when people stay apart to stop sickness","words someone says or writes exactly","a search for something important","soft wet sand that can trap feet","a baked food like a pie","another name for liquid mercury"],
          "R": ["a small hopping animal with long ears","colored light in the sky after rain","a vehicle that travels to space","a machine that can do tasks","a clever animal with a mask-like face","a deer with antlers in cold places","a very large animal with a horn","a long flowing waterway","a tricky question or puzzle","a big cold box that keeps food fresh","using old things again to make less waste","a long trip on the road","a drop of rain","helping someone who is in danger","an image seen in water or a mirror","a controller you use from far away","a place where people eat meals","a thin strip used for tying or decoration","a fast ride with hills and turns","a red berry that is sweet and tart"],
          "S": ["the star at the center of our solar system","a bright point of light in the night sky","a vehicle that can travel in space","a tiny piece of snow with a pattern","a red fruit with seeds on the outside","a castle made from sand","a small ride you stand on and push","a sea animal shaped like a star","a tiny shining flash","warm light from the sun","a book full of stories","a hero with special powers","a long piece of music for an orchestra","cream that protects skin from sun","a person who studies science","a hunt to find hidden items","the outline of buildings against the sky","waves made by sound","a sweet treat made with sugar and fruit","a fish with a long pointed nose"],
          "T": ["a big striped wild cat","a tool for seeing faraway objects","valuable things like gold or jewels","a spinning storm shaped like a funnel","a small orange fruit","a bouncy mat you jump on","a box for tools","a brush for cleaning teeth","loud sound after lightning","a strong metal element","a plan that shows times and events","a warm sweater with a tall collar","a small drop from your eye","a score in American football","a person who leads the way on trails","a machine that changes into another shape in stories","a cloth with pictures woven into it","a slow animal with a shell","a pot for making tea","a light at a road crossing that controls cars"],
          "U": ["a cover you hold to stop rain","a make-believe horse with one horn","everything in space and beyond","a one-wheeled bicycle","under the surface of water","a change to make something newer or better","a tool like a fork or spoon","special clothes worn for school or work","a small guitar-like instrument","a picture test that uses sound waves inside the body","a rising current of air","a loud noisy commotion","everyone singing or acting together","a strong pull of water under waves","a service like water or electricity","a place where people study after school","a movement to rise up","a capital letter in writing","a person who uses a computer system","a perfect place in stories"],
          "V": ["a mountain that can erupt lava","time away from work or school","winning or success","a soft fabric with a smooth feel","a small shaking movement","a string instrument played with a bow","an electronic game you play","a small town in the countryside","words you know and use","a card or gift for someone you love","a plant you eat for health","a person who served in the military","a way of looking at something","a place where grapes are grown","a sport played with a net and ball","a person who travels far to explore","a large bird that eats dead animals","a vehicle used to carry things","a container for flowers","something used for travel like a car or bike"],
          "W": ["a very large sea animal","water that falls over a cliff","a fast spinning wind","a magical or amazing place","a cart pulled by people or animals","a wild natural area","a breakfast food with squares","a suit you wear in water","a soft quiet voice","a person who does magic in stories","a flower that grows in nature","a place where people build or learn by doing","a bird that pecks wood","a tall tower for watching or guarding","a distance between wave peaks","a fun ride that slides with water","a building or machine that turns wind into power","a watch you wear on your wrist","paper with patterns for walls","a map of the world"],
          "X": ["a musical instrument with wooden bars","a picture that shows inside the body","a chemical element used in some lights","plant tissue that carries water","a photocopy or a copy of a page","a sweetener found in some gums","a piece of rock trapped inside another rock","a person who likes foreign cultures","a person who fears foreigners","the origin of something from outside","a small part at the bottom of the breastbone","an order of sea animals including horseshoe crabs","a long garden walkway, often covered","a plant sugar found in wood","a woody fruit with a hard shell","a plant that grows in very dry places","a type of chemical salt related to xanthic acid","a yellow pigment found in plants","a genus of African clawed frogs","rule by strangers or foreigners"],
          "Y": ["a large hairy animal like a cow","a starchy root you can eat","thread used for knitting","a boat used for sailing","a small outdoor area around a house","a long ruler for measuring a yard","a book of school photos and memories","a tiny living thing used to make bread rise","an exercise practice that uses poses and breathing","a creamy food made from milk","the yellow part inside an egg","a small round tent-like home","a type of evergreen tree","a type of tuna fish","a style of singing with long notes","a child or teen","the day before today","a log made of cake or wood for holidays","a plant with feathery leaves","a make-believe snow monster"],
          "Z": ["a striped black-and-white animal","a green vegetable like a squash","a tool that closes clothing or bags","a place where animals are kept for people to see","a person who cares for zoo animals","a large airship","a line that goes left and right","a set of star signs","the number 0","the highest point","a mineral used in jewelry and stones","a bright flower that looks like a daisy","a strong tasty flavor","a make-believe undead creature in stories","an area or section","moving quickly closer or farther in a camera","a string instrument like a small guitar","a breed of humped cattle","a chemical element used in metals","a molecule with both positive and negative charges"]
        };

        // Build word->meaning map and validate
        const meaningMap = new Map();
        for (const L of Object.keys(WORD_BANK)) {
          const words = WORD_BANK[L];
          const means = MEANINGS_BY_LETTER[L];
          if (!words || !means || words.length !== means.length) {
            throw new Error(`Meaning list mismatch for letter ${L}.`);
          }
          for (let i = 0; i < words.length; i++) {
            meaningMap.set(words[i], means[i]);
          }
        }

        // ----------------------------
        // SMART, MEANINGFUL SENTENCES (NOT definitions)
        // ----------------------------
        const SENTENCE_TEMPLATES = {
          animal: [
            w => `We saw ${articleFor(w)} ${w} at the zoo.`,
            w => `The ${w} moved quietly and looked around.`,
            w => `I learned about the ${w} in a nature book.`,
            w => `The ${w} used its body to stay safe.`
          ],
          bird: [
            w => `A ${w} flew across the sky near our house.`,
            w => `We listened as the ${w} made sounds outside.`,
            w => `The ${w} looked for food in the yard.`
          ],
          insect: [
            w => `A ${w} crawled on a leaf and then flew away.`,
            w => `We watched the ${w} carefully without touching it.`,
            w => `The ${w} helped nature in its own way.`
          ],
          fish_sea: [
            w => `We spotted a ${w} swimming in the water.`,
            w => `The ${w} moved smoothly through the waves.`,
            w => `At the aquarium, the ${w} was my favorite.`
          ],
          fruit: [
            w => `I ate ${articleFor(w)} ${w} with my snack.`,
            w => `We cut the ${w} and shared it at home.`,
            w => `The ${w} tasted fresh and sweet.`
          ],
          vegetable: [
            w => `We added the ${w} to dinner to make it healthy.`,
            w => `I tried the ${w} even though it was new to me.`,
            w => `The ${w} was crunchy when I took a bite.`
          ],
          food: [
            w => `I had ${articleFor(w)} ${w} after school.`,
            w => `We made ${w} together in the kitchen.`,
            w => `The ${w} smelled delicious.`
          ],
          place: [
            w => `We visited the ${w} and learned something new.`,
            w => `I want to go to the ${w} again someday.`,
            w => `The ${w} was busy and exciting.`
          ],
          tool: [
            (w, purpose) => purpose ? `I used the ${w} to ${purpose}.` : `I used the ${w} carefully to help me.`,
            (w, purpose) => purpose ? `The ${w} helped me ${purpose}.` : `The ${w} helped me do my task.`,
          ],
          vehicle: [
            w => `The ${w} took us to our destination safely.`,
            w => `I watched the ${w} move fast and smooth.`,
            w => `We climbed into the ${w} and got ready to go.`
          ],
          person: [
            w => `The ${w} helped us when we needed it.`,
            w => `I asked the ${w} a question, and they answered kindly.`,
            w => `The ${w} did their job very well.`
          ],
          clothing: [
            w => `I wore my ${w} because it was comfortable.`,
            w => `My ${w} kept me ready for the day.`,
            w => `I put on the ${w} before we went outside.`
          ],
          object: [
            w => `I picked up the ${w} and used it right away.`,
            w => `The ${w} was on the table in front of me.`,
            w => `I put the ${w} back where it belongs.`
          ],
          concept: [
            w => `We talked about ${w} in class today.`,
            w => `${capWord(w)} is important when we learn and grow.`,
            w => `I practiced ${w} by making a good choice.`
          ],
          weather: [
            w => `We stayed inside because the ${w} was strong.`,
            w => `The ${w} changed what we did that day.`,
            w => `After the ${w}, everything felt calmer.`
          ],
          science: [
            w => `In science class, we learned what ${w} means.`,
            w => `We saw the word ${w} in a science book.`,
            w => `The teacher explained ${w} with an example.`
          ],
          time: [
            w => `I checked the time and waited one ${w}.`,
            w => `In one ${w}, a lot can happen.`,
            w => `We used a ${w} to plan our day.`
          ],
          default: [
            w => `I used the word ${w} in a sentence today.`,
            w => `I can spell ${w} and say it clearly.`,
            w => `I learned something new about ${w}.`
          ]
        };

        function pick(arr){ return arr[randInt(0, arr.length - 1)]; }

        function extractPurpose(meaning){
          // If meaning contains "to ____", use that as a natural action phrase.
          // Example: "a tool you climb to reach high places" -> "reach high places"
          const m = String(meaning || "").toLowerCase();
          const idx = m.lastIndexOf(" to ");
          if (idx === -1) return "";
          let after = m.slice(idx + 4).trim();
          after = after.replace(/\.$/,"");
          // Keep it short for kids
          if (after.length > 50) after = after.slice(0, 50).trim();
          return after;
        }

        function categoryFor(word, meaning){
          const w = word.toLowerCase();
          const m = String(meaning || "").toLowerCase();

          // animals / birds / insects / sea
          if (m.includes("bird")) return "bird";
          if (m.includes("insect") || w === "bee" || w === "ant" || w === "butterfly") return "insect";
          if (m.includes("sea animal") || m.includes("ocean animal") || w === "octopus" || w === "jellyfish") return "fish_sea";
          if (m.includes("animal") || m.includes("reptile") || m.includes("pet") || m.includes("wild cat")) return "animal";

          // food
          if (m.includes("fruit")) return "fruit";
          if (m.includes("vegetable") || w === "broccoli" || w === "zucchini") return "vegetable";
          if (m.includes("snack") || m.includes("dessert") || m.includes("treat") || m.includes("breakfast") || m.includes("food")) return "food";

          // people
          if (m.startsWith("a person") || m.includes("a person who")) return "person";

          // vehicles
          if (m.includes("vehicle") || m.includes("boat") || m.includes("airplane") || m.includes("flying vehicle")) return "vehicle";

          // tools
          if (m.includes("a tool") || m.includes("tool") || m.includes("device") || m.includes("machine")) return "tool";

          // places
          if (m.includes("a place") || m.includes("building") || m.includes("store") || m.includes("library") || m.includes("museum") || m.includes("zoo")) return "place";

          // clothing
          if (m.includes("clothing") || m.includes("clothes") || m.includes("sweater") || m.includes("suit you wear") || m.includes("you wear")) return "clothing";

          // weather/nature events
          if (m.includes("storm") || m.includes("rain") || m.includes("snow") || m.includes("wind") || m.includes("earthquake") || m.includes("tornado") || m.includes("hurricane")) return "weather";

          // time
          if (m.includes("seconds") || m.includes("time") || w === "yesterday") return "time";

          // science words
          if (m.includes("gas") || m.includes("metal") || m.includes("chemical") || m.includes("molecule") || m.includes("element")) return "science";

          // concepts
          if (m.includes("winning") || m.includes("success") || m.includes("important") || m.includes("information") || m.includes("fair") || w === "justice" || w === "knowledge") return "concept";

          // default object
          return "object";
        }

        function buildMeaningfulSentence(word, meaning){
          const cat = categoryFor(word, meaning);
          const purpose = extractPurpose(meaning);

          if (cat === "tool") {
            const tpl = pick(SENTENCE_TEMPLATES.tool);
            return tpl(word, purpose);
          }

          const list = SENTENCE_TEMPLATES[cat] || SENTENCE_TEMPLATES.default;
          const tpl = pick(list);
          // Some templates accept (w, purpose) but most accept (w)
          return tpl.length >= 2 ? tpl(word, purpose) : tpl(word);
        }

        // ----------------------------
        // GAME SELECTION (no repeats until cycle ends)
        // ----------------------------
        const ALL_WORDS = Array.from(new Set(Object.values(WORD_BANK).flat()));
        let unused = new Set(ALL_WORDS);

        function resetCycle(){ unused = new Set(ALL_WORDS); }
        function pickWordNoRepeat(){
          if (unused.size === 0) resetCycle();
          const arr = Array.from(unused);
          const word = arr[randInt(0, arr.length - 1)];
          unused.delete(word);
          return word;
        }

        // ----------------------------
        // GAME LOGIC
        // ----------------------------
        let current = null; // { word, missingIndex, missingChar }
        let locked = false;
        let score = 0;

        function renderWord(){
          wordEl.innerHTML = "";
          const w = current.word.toUpperCase();
          for (let i = 0; i < w.length; i++){
            const span = document.createElement("span");
            span.className = "letter";
            if (i === current.missingIndex){
              span.classList.add("blank");
              span.dataset.blank = "1";
              span.textContent = " ";
            } else {
              span.textContent = w[i];
            }
            wordEl.appendChild(span);
          }
        }
        function getBlankEl(){
          return wordEl.querySelector('[data-blank="1"]');
        }

        function optionsCountForScore(s){
          if (s < 10) return 3;
          if (s < 30) return 4;
          return 5;
        }

        function generateChoices(correctChar){
          const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
          const want = optionsCountForScore(score);
          const options = new Set([correctChar]);

          // use letters from the word as distractors first (kid-friendly)
          const w = current.word.toUpperCase();
          for (let i = 0; i < w.length && options.size < want; i++){
            const ch = w[i];
            if (ch >= "A" && ch <= "Z") options.add(ch);
          }
          while (options.size < want) {
            options.add(alphabet[randInt(0, alphabet.length - 1)]);
          }
          return shuffle([...options]).slice(0, want);
        }

        function renderChoices(){
          const choices = generateChoices(current.missingChar);
          choicesRow.innerHTML = "";
          choices.forEach(ch => {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "choiceBtn";
            btn.textContent = ch;
            btn.addEventListener("click", () => onPickLetter(ch));
            choicesRow.appendChild(btn);
          });
        }

        function setChoicesEnabled(enabled){
          [...choicesRow.querySelectorAll("button")].forEach(b => b.disabled = !enabled);
        }

        function hideResult(){
          resultCard.style.display = "none";
          nextBtn.style.display = "none";
        }

        function animateLetterToBlank(letter){
          const blank = getBlankEl();
          const blankRect = blank.getBoundingClientRect();

          const activeBtn = [...choicesRow.querySelectorAll("button")].find(b => b.textContent === letter);
          const br = activeBtn.getBoundingClientRect();

          const fly = document.createElement("div");
          fly.className = "flyLetter";
          fly.textContent = letter;

          const startX = br.left + br.width/2;
          const startY = br.top + br.height/2;

          const endX = blankRect.left + blankRect.width/2;
          const endY = blankRect.top + blankRect.height/2;

          fly.style.left = (startX - 28) + "px";
          fly.style.top  = (startY - 28) + "px";

          document.body.appendChild(fly);

          const dx = endX - startX;
          const dy = endY - startY;

          requestAnimationFrame(() => {
            fly.style.transition = "transform 520ms cubic-bezier(0.2,0.9,0.2,1.0)";
            fly.style.transform = `translate(${dx}px,${dy}px) scale(0.92)`;
          });

          return new Promise(resolve => {
            fly.addEventListener("transitionend", () => {
              fly.remove();
              resolve();
            }, { once:true });
          });
        }

        function showResult(ok){
          const w = current.word;
          const meaning = meaningMap.get(w) || "something you can learn about";
          const sentence = buildMeaningfulSentence(w, meaning);

          resultCard.style.display = "block";
          nextBtn.style.display = "inline-block";

          resultTitle.innerHTML = ok
            ? `<span style="color:var(--good)">‚úÖ Correct!</span> <span style="opacity:0.85">(${w})</span>`
            : `<span style="color:var(--bad)">‚ùå Not quite.</span> <span style="opacity:0.85">The word is <b>${w}</b></span>`;

          meaningEl.innerHTML  = `<span class="label">Meaning:</span> ${meaning}.`;
          sentenceEl.innerHTML = `<span class="label">Sentence:</span> ${sentence}`;
          spellingEl.innerHTML = `<span class="label">Spelling:</span> ${spellOut(w)}`;

          const speakText = ok
            ? `Correct. The word is ${w}. Meaning: ${meaning}. Sentence: ${sentence}`
            : `Good try. The correct word is ${w}. Meaning: ${meaning}. Sentence: ${sentence}`;
          speak(speakText);
        }

        async function onPickLetter(letter){
          if (locked) return;
          locked = true;

          hideResult();
          setChoicesEnabled(false);

          await animateLetterToBlank(letter);

          const ok = (letter === current.missingChar);

          // show the correct final word after attempt
          const blank = getBlankEl();
          blank.classList.add("filled");
          blank.textContent = current.missingChar;

          if (ok){
            score += 1;
            scoreNumEl.textContent = String(score);
          } else {
            wordCardEl.classList.remove("shake");
            void wordCardEl.offsetWidth;
            wordCardEl.classList.add("shake");
          }

          showResult(ok);
          locked = false;
        }

        function newRound(){
          locked = false;
          hideResult();
          stopSpeaking();

          const word = pickWordNoRepeat();

          // pick missing index (avoid first/last when possible)
          const minIndex = word.length >= 4 ? 1 : 0;
          const maxIndex = word.length - 2 >= minIndex ? word.length - 2 : word.length - 1;
          const missingIndex = randInt(minIndex, maxIndex);

          current = {
            word,
            missingIndex,
            missingChar: word[missingIndex].toUpperCase()
          };

          renderWord();
          renderChoices();
          setChoicesEnabled(true);
        }

        nextBtn.addEventListener("click", () => {
          if (locked) return;
          newRound();
        });

        // Start
        newRound();
      } catch (err) {
        showError(err);
      }
    });
  </script>
</body>
</html>
